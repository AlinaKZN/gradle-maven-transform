buildscript {
	repositories {
		mavenCentral()
	}
	def pluginVersion = file('../../version.txt').text.trim()
	dependencies {
		classpath "com.lazan:gradle-maven-transform:$pluginVersion"
	}
}

apply plugin: 'com.lazan.maven-transform'

pomTransform {
	poms fileTree('../smallJavaMultiProject').matching {
		include 'pom.xml'
		include '*/pom.xml'
	}
	outputDirectory "$buildDir/mavenTransform"

	manyToOne {
		outputPath "settings.gradle"
		freemarkerTemplate 'settings-projects.ftl'
		context 'modelCount', { Collection models ->
			models.size()
		}
		classpath files('src/main/resources')
	}

	oneToOne {
		outputPath { mavenModel -> "${mavenModel.artifactId}.gradle".toString() }
		freemarkerTemplate 'project-dependencies.ftl'
		classpath files('src/main/resources')
	}
}
